<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DSL TITLE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <script src="sprite.js"></script>
</head>

<body>
<canvas id="canvas" width="100" height="400"></canvas>

<script>
    // set up canvas
    let canvas, ctx;
    const square_size = 30;
    canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");

    // set canvas background to black
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // todo this info reliant on input from user
    let width = 10;
    let height = 10;

    // set dimensions of grid
    setup_grid(width, height);

    // load images
    let images = ['images/cat.png', 'images/chicken.png', 'images/grass.png', 'images/path.png'];
    let loadedImages = {};

    let promiseArray = images.map(function (imgurl) {
        let prom = new Promise(function (resolve, reject) {
            let img = new Image();
            img.onload = function () {
                let name = imgurl.match(/([^\/]+)(?=\.\w+$)/)[0];
                loadedImages[name] = img;
                resolve();
            };
            img.src = imgurl;
        });
        return prom;
    });

    Promise.all(promiseArray).then(loop);

    // other stuff

    kitty = new Sprite(0, 0, width, height, square_size);

    function loop() {
        // render X times per second
        let x = 4;
        setInterval(draw, 1000 / x);
    }

    function draw() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        draw_all(loadedImages['grass']);
        kitty.move();
        // cat needs to be removed before being rerendered
        ctx.drawImage(loadedImages['cat'], kitty.x * square_size, kitty.y * square_size, square_size, square_size);

    }

    // width, height inputted as squares on a grid
    function setup_grid(width, height) {
        // multiply by 10 to convert to pixels
        document.getElementById('canvas').width = width * 30;
        document.getElementById('canvas').height = height * 30;
    }

    function draw_by_rectangle(image, top_left_x, top_left_y, bottom_right_x, bottom_right_y) {
        for (let x = top_left_x; x <= bottom_right_x; x++) {
            for (let y = top_left_y; y <= bottom_right_y; y++) {
                ctx.drawImage(image, x * square_size, y * square_size, square_size, square_size);
            }
        }
    }

    function draw_all(image) {
        for (let x = 0; x < width; x++) {
            for (let y = 0; y < height; y++) {
                ctx.drawImage(image, x * square_size, y * square_size, square_size, square_size);
            }
        }
    }

    function draw_by_coordinates(image, coordinates) {
        coordinates.forEach(function (item, index) {
            ctx.drawImage(image, item[0] * square_size, item[1] * square_size, square_size, square_size);
        });
    }

    // todo create image dictionary
    function create_sprites(name, type) {

    }

    // todo
    function draw_anywhere(image, number_of_items) {
    }

</script>
</body>
</html>

