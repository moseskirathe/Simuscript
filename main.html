<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DSL TITLE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
</head>

<body>
<canvas id="canvas" width="400" height="400"></canvas>

<script>
    let canvas, ctx;

    window.onload = function () {
        canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d");
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // render X times per second
        // let x = 8;
        // setInterval(draw, 1000 / x);

        load_images_and_draw();
    };

    // set up
    const square_size = 30;
    // the parameters for width/height will be obtained from the AST
    let width = 10;
    let height = 10;

    setup_grid(width, height);

    // width, height inputted as squares on a grid
    function setup_grid(width, height) {
        // multiply by 10 to convert to pixels
        document.getElementById('canvas').width = width * 30;
        document.getElementById('canvas').height = height * 30;
    }

    function draw_by_rectangle(image, top_left_x, top_left_y, bottom_right_x, bottom_right_y) {
        for (let x = top_left_x; x <= bottom_right_x; x++) {
            for (let y = top_left_y; y <= bottom_right_y; y++) {
                ctx.drawImage(image, x * square_size, y * square_size, square_size, square_size);
            }
        }
    }

    function draw_all(image) {
        for (let x = 0; x < width; x++) {
            for (let y = 0; y < height; y++) {
                ctx.drawImage(image, x * square_size, y * square_size, square_size, square_size);
            }
        }
    }

    function draw_by_coordinates(image, coordinates) {
        coordinates.forEach(function (item, index) {
            ctx.drawImage(image, item[0] * square_size, item[1] * square_size, square_size, square_size);
        });
    }

    // todo
    function draw_anywhere(image, number_of_items) {
    }

    // load images
    function load_images_and_draw() {
        // terrain
        const grass = new Image();
        grass.onload = draw;
        grass.onerror = function () {
            alert(grass.src + ' failed to load.');
        };
        grass.src = "images/0_terrain/grass.png";

        const path = new Image();
        path.onload = draw;
        path.onerror = function () {
            alert(path.src + ' failed to load.');
        };
        path.src = "images/0_terrain/path.png";

        // sprites
        const cat = new Image();
        cat.onload = draw;
        cat.onerror = function () {
            alert(cat.src + ' failed to load.');
        };
        cat.src = "cat.png";

        const chicken = new Image();
        chicken.onload = draw;
        chicken.onerror = function () {
            alert(chicken.src + ' failed to load.');
        };
        chicken.src = "chicken.png";

        // todo better way to track this?
        var imgCount = 4;

        function draw() {
            // countdown until all images are loaded
            if (--imgCount > 0) {
                return;
            }

            draw_all(grass);
            draw_by_rectangle(chicken, 0, 0, 0, 3);
            draw_by_coordinates(cat, [[0, 0], [1, 1], [2, 3]]);
        }
    }

</script>
</body>
</html>

